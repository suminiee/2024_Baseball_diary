{{>layouts/loginHeader}}
<title>Today's BASEBALL</title>
<style>
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid black;
        padding-bottom: 10px;
    }
    .date {
        display: flex;
        justify-content: flex-end;
        align-items: center;
    }
    .line-up, .game {
        width: 48%;
        display: inline-block;
        vertical-align: top;
    }
    .line-up table, .game table {
        width: 100%;
        border-collapse: collapse;
    }
    .line-up th, .line-up td, .game th, .game td {
        border: 1px solid black;
        text-align: center;
        padding: 5px;
    }
    .game .score-input {
        width: 50px;
        text-align: center;
    }
    .mvp {
        margin-top: 10px;
    }
    .footer {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        border-top: 2px solid black;
        padding-top: 10px;
    }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="mt-3">
            <h3>Today's</h3>
            <h3>BASEBALL</h3>
        </div>
    </div>

    <div class="content">
        <div class="line-up mt-3">
            <h4>LINE-UP</h4>
            <table>
                <thead>
                <tr>
                    <th>Position</th>
                    <th>Name</th>
                </tr>
                </thead>
                <tbody>
                {{#lineUp}}
                    <tr>
                        <td><input type="text" id="lineUpPosition{{@index}}" name="lineUpPosition" value="{{position}}"></td>
                        <td><input type="text" id="lineUpName{{@index}}" name="lineUpName" value="{{name}}"></td>
                    </tr>
                {{/lineUp}}
                {{^lineUp}}
                    <tr>
                        <td><input type="text" id="lineUpPosition1" class="form-control" name="lineUpPosition"></td>
                        <td><input type="text" id="lineUpName1" class="form-control" name="lineUpName"></td>
                    </tr>
                    <tr>
                        <td><input type="text" id="lineUpPosition2" class="form-control" name="lineUpPosition"></td>
                        <td><input type="text" id="lineUpName2" class="form-control" name="lineUpName"></td>
                    </tr>
                    <tr>
                        <td><input type="text" id="lineUpPosition3" class="form-control" name="lineUpPosition"></td>
                        <td><input type="text" id="lineUpName3" class="form-control" name="lineUpName"></td>
                    </tr>
                    <tr>
                        <td><input type="text" id="lineUpPosition4" class="form-control" name="lineUpPosition"></td>
                        <td><input type="text" id="lineUpName4" class="form-control" name="lineUpName"></td>
                    </tr>
                    <tr>
                        <td><input type="text" id="lineUpPosition5" class="form-control" name="lineUpPosition"></td>
                        <td><input type="text" id="lineUpName5" class="form-control" name="lineUpName"></td>
                    </tr>
                    <tr>
                        <td><input type="text" id="lineUpPosition6" class="form-control" name="lineUpPosition"></td>
                        <td><input type="text" id="lineUpName6" class="form-control" name="lineUpName"></td>
                    </tr>
                    <tr>
                        <td><input type="text" id="lineUpPosition7" class="form-control" name="lineUpPosition"></td>
                        <td><input type="text" id="lineUpName7" class="form-control" name="lineUpName"></td>
                    </tr>
                    <tr>
                        <td><input type="text" id="lineUpPosition8" class="form-control" name="lineUpPosition"></td>
                        <td><input type="text" id="lineUpName8" class="form-control" name="lineUpName"></td>
                    </tr>
                    <tr>
                        <td><input type="text" id="lineUpPosition9" class="form-control" name="lineUpPosition"></td>
                        <td><input type="text" id="lineUpName9" class="form-control" name="lineUpName"></td>
                    </tr>
                    <tr>
                        <td><input type="text" id="lineUpPositionPitcher" class="form-control" name="lineUpPosition" value="pitcher" readonly></td>
                        <td><input type="text" id="lineUpNamePitcher" class="form-control" name="lineUpName"></td>
                    </tr>
                {{/lineUp}}
                </tbody>
            </table>
        </div>

        <div class="game mt-3 ml-3">
            <div class="mt-5 mb-4">
                <h4>Baseball Stadium</h4>
                <select class="form-control" id="stadium" name="stadium" style="width: 200px;">
                    <option disabled selected>야구장을 선택하세요</option>
                    <option selected value="대구삼성라이온즈파크">대구삼성라이온즈파크</option>
                    <option value="잠실야구장">잠실야구장</option>
                    <option value="고척스카이돔">고척스카이돔</option>
                    <option value="수원KT위즈파크">수원KT위즈파크</option>
                    <option value="인천SSG랜더스필드">인천SSG랜더스필드</option>
                    <option value="한화생명이글스파크">한화생명이글스파크</option>
                    <option value="광주기아챔피언스필드">광주기아챔피언스필드</option>
                    <option value="사직야구장">사직야구장</option>
                    <option value="창원NC파크">창원NC파크</option>
                </select>
            </div>

            <div class="mb-4">
                <h4>DATE</h4>
                <input type="text" class="date-input form-control" id="gameDate" name="gameDate" placeholder="202X-XX-XX" style="width: 150px;" >
            </div>

            <div class="mb-4">
                <h4>TIME</h4>
                <select class="form-control" id="time" name="time" style="width: 200px;">
                    <option disabled selected>시간을 선택하세요</option>
                    <option value="14:00">14:00</option>
                    <option value="17:00">17:00</option>
                    <option value="18:30">18:30</option>
                    <option value="기타">기타</option>
                </select>
            </div>

            <div class="mb-4">
                <h4>WATCH</h4>
                <select class="form-control" id="watch" name="watch" style="width: 200px;">
                    <option disabled selected>시청방법을 선택하세요</option>
                    <option value="집관">집관</option>
                    <option value="직관">직관</option>
                    <option value="우천취소">우천취소</option>
                </select>
            </div>
            <h4>GAME</h4>
            <table>
                <tr>
                    <th>HOME</th>
                    <th>SCORE</th>
                    <th>AWAY</th>
                </tr>
                <tr>
                    <td>
                        <select class="form-control" id="homeTeam" name="homeTeam">
                            <option disabled selected>팀을 선택하세요</option>
                            <option value="삼성라이온즈">삼성라이온즈</option>
                            <option value="롯데자이언츠">롯데자이언츠</option>
                            <option value="기아타이거즈">기아타이거즈</option>
                            <option value="LG트윈스">LG트윈스</option>
                            <option value="키움히어로즈">키움히어로즈</option>
                            <option value="두산베어스">두산베어스</option>
                            <option value="NC다이노스">NC다이노스</option>
                            <option value="SSG랜더스">SSG랜더스</option>
                            <option value="한화이글스">한화이글스</option>
                            <option value="KT위즈">KT위즈</option>
                        </select>
                    </td>
                    <td>
                        <input type="text" class="score-input" id="homeScore" name="homeScore">
                        vs
                        <input type="text" class="score-input" id="awayScore" name="awayScore">
                    </td>
                    <td>
                        <select class="form-control" id="awayTeam" name="awayTeam">
                            <option disabled selected>팀을 선택하세요</option>
                            <option value="삼성라이온즈">삼성라이온즈</option>
                            <option value="롯데자이언츠">롯데자이언츠</option>
                            <option value="기아타이거즈">기아타이거즈</option>
                            <option value="LG트윈스">LG트윈스</option>
                            <option value="키움히어로즈">키움히어로즈</option>
                            <option value="두산베어스">두산베어스</option>
                            <option value="NC다이노스">NC다이노스</option>
                            <option value="SSG랜더스">SSG랜더스</option>
                            <option value="한화이글스">한화이글스</option>
                            <option value="KT위즈">KT위즈</option>
                        </select>
                    </td>
                </tr>
            </table>

            <div class="mvp mt-4">
                <h4>MY MVP</h4>
                <input type="text" id="mvp" class="form-control" style="width: 150px;" name="mvp">
            </div>
        </div>
    </div>

    <div class="footer mt-3">
        <button type="button" class="btn btn-info" id="saveDiaryButton">작성완료</button>
    </div>
</div>

<script>
    document.getElementById('saveDiaryButton').addEventListener('click', async function() {
        const gameDate = document.getElementById('gameDate').value;
        const stadium = document.getElementById('stadium').value;
        const time = document.getElementById('time').value;
        const watch = document.getElementById('watch').value;
        const homeTeam = document.getElementById('homeTeam').value;
        const homeScore = document.getElementById('homeScore').value;
        const awayTeam = document.getElementById('awayTeam').value;
        const awayScore = document.getElementById('awayScore').value;
        const mvp = document.getElementById('mvp').value;

        const lineUpPositions = [];
        const lineUpNames = [];
        for (let i = 0; i < 9; i++) {
            lineUpPositions.push({
                position: document.getElementById(`lineUpPosition${i + 1}`).value,
            });
            lineUpNames.push({
                name: document.getElementById(`lineUpName${i + 1}`).value,
            });
        }

        const diarySaveRequestDto = {
            gameDate,
            stadium,
            time,
            watch,
            homeTeam,
            homeScore,
            awayTeam,
            awayScore,
            mvp,
        };

        const saveObj = {
            diarySaveRequestDto,
            lineUpNameSaveRequestDto: { lineUpNames },
            lineUpPositionSaveRequestDto: { lineUpPositions },
        };

        try {
            const response = await fetch('/api/diary/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(saveObj),
            });

            if (response.ok) {
                alert("Diary saved successfully");
                window.location.href = `/diary/view/${gameDate}`;
            } else {
                alert("Failed to save diary");
            }
        } catch (error) {
            console.error("Error saving diary:", error);
            alert("An error occurred while saving the diary");
        }
    });


</script>

{{>layouts/loginFooter}}
